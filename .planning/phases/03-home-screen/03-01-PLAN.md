---
phase: 03-home-screen
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/home/FlipCard.tsx
  - components/home/StatsFlipCard.tsx
autonomous: true

must_haves:
  truths:
    - "Tapping a flip card smoothly rotates it 180 degrees to reveal the back face"
    - "Flip animation completes in 300-400ms with rotateY transform"
    - "Both front and back faces render correctly on iOS and Android (perspective as first transform)"
    - "Only one face is visible at a time (backfaceVisibility hidden)"
    - "Streak card front shows fire icon, current streak number, and 'Days Active' label"
    - "Streak card back shows personal best streak number"
    - "Nature Score card front shows leaf icon, calculated score, and 'Room to Improve' label"
    - "Nature Score card back shows breakdown logic text"
  artifacts:
    - path: "components/home/FlipCard.tsx"
      provides: "Generic reusable flip card with Reanimated 4 3D animation"
      exports: ["FlipCard"]
    - path: "components/home/StatsFlipCard.tsx"
      provides: "Streak and Nature Score flip card wrappers consuming FlipCard"
      exports: ["StreakFlipCard", "NatureScoreFlipCard"]
  key_links:
    - from: "components/home/FlipCard.tsx"
      to: "react-native-reanimated"
      via: "useSharedValue, useAnimatedStyle, withTiming, interpolate"
      pattern: "interpolate.*isFlipped.*\\[0, 1\\].*\\[0, 180\\]"
    - from: "components/home/StatsFlipCard.tsx"
      to: "components/home/FlipCard.tsx"
      via: "import and render FlipCard with front/back content"
      pattern: "import.*FlipCard.*from.*FlipCard"
    - from: "components/home/StatsFlipCard.tsx"
      to: "@/lib/mock"
      via: "import MOCK_STATS for streak and nature score values"
      pattern: "import.*MOCK_STATS.*from.*mock"
---

<objective>
Build the FlipCard reusable animation component and its Streak/NatureScore wrappers.

Purpose: FlipCard is the foundational animation component reused across Phase 3 (stats) and future phases (giveaway, grand prize, wallet). Getting the 3D flip animation right -- especially the Android perspective ordering -- is the critical path for this phase.

Output: Two files in `components/home/` -- a generic `FlipCard` that accepts front/back ReactNode children and handles the Reanimated 4 rotateY animation, plus `StatsFlipCard` that exports `StreakFlipCard` and `NatureScoreFlipCard` with themed content consuming mock data.
</objective>

<execution_context>
@/Users/turbolaunch/.claude/get-shit-done/workflows/execute-plan.md
@/Users/turbolaunch/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-home-screen/03-CONTEXT.md
@.planning/phases/03-home-screen/03-RESEARCH.md
@components/CLAUDE.md
@contexts/theme-context.tsx
@constants/colors.ts
@constants/shadows.ts
@lib/mock/types.ts
@lib/mock/data.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create generic FlipCard component with Reanimated 4 3D animation</name>
  <files>components/home/FlipCard.tsx</files>
  <action>
Create `components/home/FlipCard.tsx` exporting a `FlipCard` component.

**Props interface:**
```typescript
interface FlipCardProps {
  front: React.ReactNode;
  back: React.ReactNode;
  height?: number;       // Card height (default 140)
  duration?: number;     // Animation duration in ms (default 400)
}
```

**Animation implementation using Reanimated 4:**
- `isFlipped` as `useSharedValue(0)` (0 = front, 1 = back)
- `handlePress` toggles: `isFlipped.value = withTiming(isFlipped.value === 0 ? 1 : 0, { duration })`
- `frontAnimatedStyle` uses `useAnimatedStyle` with:
  - `transform: [{ perspective: 1000 }, { rotateY: interpolate(isFlipped.value, [0, 1], [0, 180]) + 'deg' }]`
  - `backfaceVisibility: 'hidden'`
- `backAnimatedStyle` uses `useAnimatedStyle` with:
  - `transform: [{ perspective: 1000 }, { rotateY: interpolate(isFlipped.value, [0, 1], [180, 360]) + 'deg' }]`
  - `backfaceVisibility: 'hidden'`

**CRITICAL:** `{ perspective: 1000 }` MUST be the FIRST item in the transform array for Android compatibility. This is a known React Native issue where Android applies transforms in reverse order.

**Layout:**
- Outer `Pressable` wrapping a `View` with `position: 'relative'`
- Front face: `Animated.View` with `flex: 1`, rounded corners (borderRadius 16), themed `cardBackground` color
- Back face: `Animated.View` with `position: 'absolute', top: 0, left: 0, right: 0, bottom: 0`, same styling
- Both faces get padding 16

**Styling:**
- Use `useTheme()` for `colors.cardBackground`, `colors.cardBorder`, `shadows.md`
- Apply shadow from theme's `shadows.md` to outer container
- Border: 1px `cardBorder` on both faces
- `overflow: 'hidden'` on both faces for content clipping

Do NOT add tap affordance text or icons -- per CONTEXT.md this is at Claude's discretion, and the discovery-based approach (no visual hint) is recommended in RESEARCH.md.
  </action>
  <verify>
`npx tsc --noEmit` passes with zero errors. Verify the component exports correctly by checking TypeScript can resolve the import path.
  </verify>
  <done>
FlipCard component exists at `components/home/FlipCard.tsx`, accepts `front` and `back` ReactNode props, animates with Reanimated 4 `rotateY` transform (300-400ms), has `perspective: 1000` as first transform for Android, and uses `backfaceVisibility: 'hidden'` on both faces.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create StreakFlipCard and NatureScoreFlipCard wrappers</name>
  <files>components/home/StatsFlipCard.tsx</files>
  <action>
Create `components/home/StatsFlipCard.tsx` exporting two named components: `StreakFlipCard` and `NatureScoreFlipCard`.

Both components wrap the generic `FlipCard` from `./FlipCard` and provide themed front/back content.

**StreakFlipCard:**
- Front face content:
  - `Flame` icon from `lucide-react-native` (size 28, color `colors.highlight` which is orange)
  - `MOCK_STATS.currentStreak` as large bold number (fontSize 32, fontWeight '800')
  - "Days Active" label text (fontSize 13, `colors.textSecondary`)
  - Layout: column, items centered, gap 4
- Back face content:
  - "Personal Best" label (fontSize 13, `colors.textSecondary`)
  - `MOCK_STATS.longestStreak` as large bold number (fontSize 36, fontWeight '800', `colors.highlight`)
  - "day streak" subtitle (fontSize 13, `colors.textSecondary`)
  - Layout: column, items centered, justify center

**NatureScoreFlipCard:**
- Front face content:
  - `Leaf` icon from `lucide-react-native` (size 28, color `colors.accent`)
  - Nature score value: compute as `Math.round(MOCK_STATS.totalMinutes * 0.05)` displayed as large bold number (fontSize 32, fontWeight '800')
  - "Room to Improve" label text (fontSize 13, `colors.textSecondary`)
  - Layout: column, items centered, gap 4
- Back face content:
  - "Nature Score" label (fontSize 13, `colors.textSecondary`)
  - Score breakdown text: "Based on {totalMinutes} minutes of outdoor activity across {totalActivities} sessions" (fontSize 13, `colors.textSecondary`, textAlign center)
  - Layout: column, items centered, justify center

**Both cards:**
- Import `MOCK_STATS` from `@/lib/mock`
- Import `useTheme` from `@/contexts/theme-context`
- Number text uses `colors.textPrimary`
- Pass `height={140}` and `duration={400}` to FlipCard
- No extra padding needed (FlipCard handles padding internally)
  </action>
  <verify>
`npx tsc --noEmit` passes. Both `StreakFlipCard` and `NatureScoreFlipCard` are exported as named exports.
  </verify>
  <done>
`StreakFlipCard` renders fire icon + current streak (12) + "Days Active" on front, personal best streak (18) on back. `NatureScoreFlipCard` renders leaf icon + nature score (171) + "Room to Improve" on front, breakdown text on back. Both use FlipCard for 3D flip animation.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. Both files exist: `components/home/FlipCard.tsx`, `components/home/StatsFlipCard.tsx`
3. FlipCard uses Reanimated 4 imports (useSharedValue, useAnimatedStyle, withTiming, interpolate)
4. Perspective is first transform in both front and back animated styles
5. backfaceVisibility is 'hidden' on both faces
6. StreakFlipCard and NatureScoreFlipCard both import and render FlipCard
7. Mock data imported from `@/lib/mock` (not hardcoded values)
</verification>

<success_criteria>
- FlipCard is a generic, reusable component that accepts any front/back ReactNode content
- Flip animation uses Reanimated 4 rotateY with 400ms duration
- Android-safe perspective ordering (perspective: 1000 as first transform)
- Both faces hidden when facing away (backfaceVisibility)
- StreakFlipCard displays current streak (front) and personal best (back)
- NatureScoreFlipCard displays nature score (front) and breakdown text (back)
- All TypeScript types explicit, no `any` usage
- Theme colors used throughout (no hardcoded hex values for text/backgrounds)
</success_criteria>

<output>
After completion, create `.planning/phases/03-home-screen/03-01-SUMMARY.md`
</output>
