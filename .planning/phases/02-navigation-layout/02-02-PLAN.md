---
phase: 02-navigation-layout
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - components/navigation/TopBar.tsx
  - app/(tabs)/index.tsx
  - app/(tabs)/stash.tsx
  - app/(tabs)/squad.tsx
autonomous: true

must_haves:
  truths:
    - "TopBar appears on all three tab screens"
    - "TopBar shows daily affirmation text in center"
    - "TopBar shows current date formatted as 'MMM DD' on left"
    - "TopBar shows profile avatar on right"
    - "Tapping avatar navigates to Profile modal"
    - "Pull-to-refresh rotates the affirmation text"
    - "TopBar scrolls away with content (not sticky)"
  artifacts:
    - path: "components/navigation/TopBar.tsx"
      provides: "Shared TopBar with date, affirmation, avatar"
      min_lines: 40
      exports: ["TopBar"]
    - path: "app/(tabs)/index.tsx"
      provides: "Home screen with TopBar and pull-to-refresh"
      min_lines: 20
    - path: "app/(tabs)/stash.tsx"
      provides: "Stash screen with TopBar and pull-to-refresh"
      min_lines: 20
    - path: "app/(tabs)/squad.tsx"
      provides: "Squad screen with TopBar and pull-to-refresh"
      min_lines: 20
  key_links:
    - from: "components/navigation/TopBar.tsx"
      to: "app/(modals)/profile"
      via: "router.push('/(modals)/profile') on avatar press"
      pattern: "router\\.push.*modals.*profile"
    - from: "components/navigation/TopBar.tsx"
      to: "lib/mock/data.ts"
      via: "MOCK_AFFIRMATIONS import for rotation"
      pattern: "MOCK_AFFIRMATIONS"
    - from: "app/(tabs)/index.tsx"
      to: "components/navigation/TopBar.tsx"
      via: "TopBar rendered inside ScrollView"
      pattern: "<TopBar"
---

<objective>
Create the shared TopBar component (date + affirmation + avatar) and wire it into all three tab screens with pull-to-refresh affirmation rotation.

Purpose: Provides consistent navigation chrome across all tabs. Affirmation rotation gives users a reason to interact with the header. Avatar provides quick access to Profile.
Output: TopBar component rendered on all tab screens, scrolling with content, with pull-to-refresh affirmation cycling.
</objective>

<execution_context>
@/Users/turbolaunch/.claude/get-shit-done/workflows/execute-plan.md
@/Users/turbolaunch/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-navigation-layout/02-CONTEXT.md
@.planning/phases/02-navigation-layout/02-RESEARCH.md
@.planning/phases/02-navigation-layout/02-01-SUMMARY.md

Key files:
@lib/mock/data.ts — MOCK_AFFIRMATIONS array (8 affirmation strings), MOCK_USER (avatarUrl)
@lib/mock/types.ts — MockUser interface
@contexts/theme-context.tsx — useTheme() for colors
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TopBar component</name>
  <files>
    components/navigation/TopBar.tsx
  </files>
  <action>
    Create `components/navigation/TopBar.tsx` with:

    **Props interface:**
    ```typescript
    interface TopBarProps {
      affirmation: string;
      avatarUrl: string;
    }
    ```

    **Layout (from CONTEXT.md):**
    - Left: Date formatted as "MMM DD" (e.g., "Jan 27") — use `new Date().toLocaleDateString('en-US', { month: 'short', day: 'numeric' })`
    - Center: Affirmation text (passed as prop) — flex-1, centered
    - Right: Profile avatar — 40px (medium), tappable

    **Avatar:**
    - Use HeroUI Native `Avatar` component with `Avatar.Image` and `Avatar.Fallback`
    - Size: "md" (40px per CONTEXT.md)
    - Source: `{ uri: avatarUrl }` prop
    - Wrap in `Pressable` — onPress: `router.push('/(modals)/profile')`

    **Styling:**
    - Use Uniwind className for layout: `flex-row items-center justify-between px-4 py-3`
    - Date text: `text-sm font-semibold` with theme foreground color
    - Affirmation text: `flex-1 text-center text-sm px-4` with secondary foreground color
    - Give the date a fixed width so the affirmation text stays centered (e.g., `w-16`)

    **Named export:** `export function TopBar({ affirmation, avatarUrl }: TopBarProps)`

    Import order: React Native -> expo-router -> heroui-native -> @/ aliases
  </action>
  <verify>
    `npx tsc --noEmit` passes. File exists at components/navigation/TopBar.tsx.
    `grep "router.push" components/navigation/TopBar.tsx` confirms avatar navigates to profile.
  </verify>
  <done>
    TopBar component exists with date (MMM DD), centered affirmation text, and tappable avatar that navigates to /(modals)/profile.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire TopBar into all tab screens with pull-to-refresh</name>
  <files>
    app/(tabs)/index.tsx
    app/(tabs)/stash.tsx
    app/(tabs)/squad.tsx
  </files>
  <action>
    **For each of the 3 tab screens**, add TopBar and pull-to-refresh:

    **Shared pattern for all screens:**

    1. Import `TopBar` from `@/components/navigation/TopBar`
    2. Import `MOCK_AFFIRMATIONS`, `MOCK_USER` from `@/lib/mock`
    3. Import `RefreshControl` from `react-native`
    4. Add state: `affirmationIndex` (useState, initialized to random index via `Math.floor(Math.random() * MOCK_AFFIRMATIONS.length)`)
    5. Add state: `refreshing` (useState, false)
    6. Add `onRefresh` handler:
       ```typescript
       const onRefresh = useCallback(() => {
         setRefreshing(true);
         setAffirmationIndex((prev) => (prev + 1) % MOCK_AFFIRMATIONS.length);
         setTimeout(() => setRefreshing(false), 500);
       }, []);
       ```
    7. Render `<TopBar affirmation={MOCK_AFFIRMATIONS[affirmationIndex]} avatarUrl={MOCK_USER.photoURL} />` as FIRST child inside ScrollView
    8. Add `<RefreshControl refreshing={refreshing} onRefresh={onRefresh} />` to ScrollView

    **Home screen (`app/(tabs)/index.tsx`):**
    - Replace the current complex home screen content with a simplified placeholder (this is Phase 2 — just navigation chrome, not full Home content which comes in Phase 3)
    - Keep a basic placeholder: title "Home" and subtitle "Your outdoor activity dashboard"
    - Render TopBar as first child inside ScrollView
    - Add RefreshControl
    - Use Uniwind className styling instead of StyleSheet
    - Remove ALL existing imports for Firebase db, health connection, activities, stats, etc. — those belong to the old version and will be rebuilt in Phase 3
    - Import from `@/lib/mock` instead

    **Stash screen (`app/(tabs)/stash.tsx`):**
    - Update the placeholder created in Plan 02-01
    - Add TopBar and RefreshControl
    - Keep placeholder content: title "Your Stash" and subtitle "Rewards and offers from our partners"

    **Squad screen (`app/(tabs)/squad.tsx`):**
    - Update the placeholder created in Plan 02-01
    - Add TopBar and RefreshControl
    - Keep placeholder content: title "Your Squad" and subtitle "Everything's better together."

    **IMPORTANT:**
    - TopBar is INSIDE the ScrollView (scrolls away with content per CONTEXT.md decision)
    - Each screen manages its own affirmation state (independent rotation per tab)
    - Use `useCallback` for onRefresh to avoid unnecessary re-renders
    - Safe area padding: account for top inset in ScrollView contentContainerStyle
    - Bottom padding: account for tab bar height (Material Top Tabs at bottom)
  </action>
  <verify>
    `npx tsc --noEmit` passes with zero errors.
    `grep -r "TopBar" app/(tabs)/index.tsx app/(tabs)/stash.tsx app/(tabs)/squad.tsx` shows TopBar in all 3 screens.
    `grep -r "RefreshControl" app/(tabs)/index.tsx app/(tabs)/stash.tsx app/(tabs)/squad.tsx` shows RefreshControl in all 3 screens.
    `grep -r "MOCK_AFFIRMATIONS" app/(tabs)/` confirms mock data usage.
  </verify>
  <done>
    TopBar renders on all 3 tab screens (Home, Your Stash, Your Squad). Pull-to-refresh rotates affirmation text. TopBar scrolls away with content. Avatar tap navigates to Profile modal. Home screen simplified to placeholder content for Phase 2.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero TypeScript errors
2. TopBar component exists at components/navigation/TopBar.tsx
3. All 3 tab screens render TopBar with affirmation and avatar
4. Pull-to-refresh works on all 3 screens (rotates affirmation)
5. Avatar tap in TopBar navigates to /(modals)/profile
6. TopBar is inside ScrollView (scrolls away, not sticky)
7. Mock data (MOCK_AFFIRMATIONS, MOCK_USER) used instead of Firebase
</verification>

<success_criteria>
- TopBar visible on all 3 tab screens showing date (MMM DD), affirmation, and avatar
- Tapping avatar navigates to Profile screen (modal)
- Pull-to-refresh on any tab rotates the affirmation text
- TopBar scrolls with content (not fixed/sticky)
- No Firebase imports in any tab screen (mock data only)
- TypeScript compilation passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-navigation-layout/02-02-SUMMARY.md`
</output>
