---
phase: 02-navigation-layout
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/(tabs)/_layout.tsx
  - app/(tabs)/stash.tsx
  - app/(tabs)/squad.tsx
  - app/(modals)/profile.tsx
  - app/_layout.tsx
  - components/navigation/ParkerFAB.tsx
  - package.json
autonomous: true

must_haves:
  truths:
    - "Bottom tab bar shows three tabs: Home, Your Stash, Your Squad"
    - "Parker FAB (bear icon) is visible in the bottom-right corner on every tab"
    - "Parker FAB opens Parker Chat screen on tap"
    - "Profile screen opens as modal from bottom (not a tab)"
    - "Tab swiping between tabs works with horizontal slide animation"
  artifacts:
    - path: "app/(tabs)/_layout.tsx"
      provides: "3-tab layout with Material Top Tabs at bottom, Parker FAB overlay"
      min_lines: 40
    - path: "app/(tabs)/stash.tsx"
      provides: "Your Stash placeholder screen"
      min_lines: 10
    - path: "app/(tabs)/squad.tsx"
      provides: "Your Squad placeholder screen"
      min_lines: 10
    - path: "components/navigation/ParkerFAB.tsx"
      provides: "Parker bear FAB component with spring entrance animation"
      min_lines: 30
    - path: "app/(modals)/profile.tsx"
      provides: "Profile screen as modal route"
      min_lines: 10
  key_links:
    - from: "components/navigation/ParkerFAB.tsx"
      to: "/chat"
      via: "router.push('/chat') on press"
      pattern: "router\\.push.*chat"
    - from: "app/(tabs)/_layout.tsx"
      to: "components/navigation/ParkerFAB.tsx"
      via: "import and render in tab layout"
      pattern: "ParkerFAB"
    - from: "app/_layout.tsx"
      to: "app/(modals)/profile.tsx"
      via: "Stack.Screen with presentation: 'modal'"
      pattern: "presentation.*modal"
---

<objective>
Restructure bottom tab navigation from 4 tabs (Home, Explore, Rewards, Profile) to 3 tabs (Home, Your Stash, Your Squad) with Material Top Tabs at bottom for swipe + horizontal slide, add Parker FAB visible on all tabs, and move Profile to a modal route.

Purpose: Establishes the navigation shell that wraps all future screen content. Every subsequent phase builds inside this structure.
Output: Working 3-tab app with swipeable tabs, Parker FAB, and Profile modal route.
</objective>

<execution_context>
@/Users/turbolaunch/.claude/get-shit-done/workflows/execute-plan.md
@/Users/turbolaunch/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-navigation-layout/02-CONTEXT.md
@.planning/phases/02-navigation-layout/02-RESEARCH.md

Key existing files to understand:
@app/(tabs)/_layout.tsx — Current 4-tab layout (Home, Explore, Rewards, Profile) using Expo Router Tabs
@app/_layout.tsx — Root layout with Stack, providers, auth routing
@app/(tabs)/explore.tsx — Being removed (replaced by squad.tsx)
@app/(tabs)/rewards.tsx — Being removed (replaced by stash.tsx)
@app/(tabs)/profile.tsx — Moving from tab to modal at app/(modals)/profile.tsx
@app/(modals)/_layout.tsx — Modal stack layout
@components/haptic-tab.tsx — Existing haptic tab button wrapper
@contexts/theme-context.tsx — Theme context with colors, isDark, shadows
@lib/mock/data.ts — MOCK_AFFIRMATIONS array exists here
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Material Top Tabs dependencies and create ParkerFAB</name>
  <files>
    package.json
    components/navigation/ParkerFAB.tsx
  </files>
  <action>
    **Step 1: Install dependencies**
    Run: `npm install @react-navigation/material-top-tabs react-native-tab-view react-native-pager-view`

    These are required for swipeable tab navigation with horizontal slide animations (CONTEXT.md decision: tab swiping enabled, horizontal slide animation).

    **Step 2: Create `components/navigation/ParkerFAB.tsx`**

    Create a floating action button component:
    - Absolutely positioned in bottom-right corner of the screen (above tab bar area)
    - Use `PawPrint` icon from lucide-react-native (bear paw for Parker)
    - On press: `router.push('/chat')` to open Parker Chat (existing full-screen modal)
    - Spring entrance animation using Reanimated 4: scale from 0 to 1 with `withSpring({ damping: 15 })`
    - Use theme colors via `useTheme()` -- accent color background, white icon
    - Use `useSafeAreaInsets()` for proper bottom offset
    - Size: 56x56 rounded-full with shadow
    - Use `className` for Uniwind styling where possible, `style` only for dynamic values (Reanimated animated style, safe area insets)

    Named export: `export function ParkerFAB()`

    Import order: React -> React Native -> expo-router -> lucide -> react-native-reanimated -> react-native-safe-area-context -> @/ aliases
  </action>
  <verify>
    `npm ls @react-navigation/material-top-tabs react-native-tab-view react-native-pager-view` shows all three installed.
    `npx tsc --noEmit` passes (ParkerFAB compiles without errors).
  </verify>
  <done>
    Material Top Tabs and supporting libraries installed. ParkerFAB component exists at components/navigation/ParkerFAB.tsx with spring animation, PawPrint icon, and navigation to /chat.
  </done>
</task>

<task type="auto">
  <name>Task 2: Restructure tabs, create placeholder screens, move Profile to modal</name>
  <files>
    app/(tabs)/_layout.tsx
    app/(tabs)/stash.tsx
    app/(tabs)/squad.tsx
    app/(modals)/profile.tsx
    app/(modals)/_layout.tsx
    app/_layout.tsx
  </files>
  <action>
    **Step 1: Create placeholder tab screens**

    Create `app/(tabs)/stash.tsx` — "Your Stash" placeholder:
    - Simple ScrollView with safe area insets
    - Title "Your Stash" and subtitle text
    - Use `useTheme()` for colors
    - Named default export: `export default function StashScreen()`
    - Use Uniwind className styling

    Create `app/(tabs)/squad.tsx` — "Your Squad" placeholder:
    - Simple ScrollView with safe area insets
    - Title "Your Squad" and subtitle "Everything's better together." (from CONTEXT.md)
    - Use `useTheme()` for colors
    - Named default export: `export default function SquadScreen()`
    - Use Uniwind className styling

    **Step 2: Move Profile to modal**

    Create `app/(modals)/profile.tsx`:
    - Copy the existing `app/(tabs)/profile.tsx` content into this file
    - Add a dismiss button (X icon) at the top that calls `router.back()` to close the modal
    - Keep all existing Profile functionality intact (sign out, health connection, dark mode, etc.)

    Update `app/(modals)/_layout.tsx`:
    - Add `<Stack.Screen name="profile" />` to the modal stack
    - Change the profile screen's presentation to `"modal"` (not transparentModal) since Profile should slide from bottom as a card modal, not a transparent overlay
    - Override profile screen options: `presentation: "modal"`, `animation: "slide_from_bottom"`

    Update `app/_layout.tsx`:
    - Verify the `(modals)` Stack.Screen already exists (it does)
    - No changes needed to root layout since (modals) group already handles modal presentation

    **Step 3: Rewrite tab layout**

    Rewrite `app/(tabs)/_layout.tsx` to use Material Top Tabs at bottom:

    ```
    import { createMaterialTopTabNavigator } from '@react-navigation/material-top-tabs';
    import { withLayoutContext } from 'expo-router';
    ```

    Use `withLayoutContext` to wrap the Material Top Tabs Navigator for Expo Router compatibility.

    Configuration:
    - `tabBarPosition="bottom"` — tabs at bottom of screen
    - `swipeEnabled={true}` — enable tab swiping (CONTEXT.md decision)
    - `lazy={true}` with `lazyPreloadDistance={0}` — performance optimization
    - Tab bar styling: use theme colors (tabIconActive, tabIconInactive, tabBarBackground, tabBarBorder)
    - Tab bar label: fontSize 11, fontWeight 600
    - Hide the swipe indicator: `tabBarIndicatorStyle: { display: 'none' }`
    - Apply iOS blur using BlurView as `tabBarBackground` (existing pattern from current layout)
    - Apply safe area bottom padding using `useSafeAreaInsets()`
    - Keep `headerShown: false` (screens manage their own headers)

    Tab screens (3 only):
    1. `index` — title "Home", icon `Home` from lucide-react-native
    2. `stash` — title "Your Stash", icon `Gift` from lucide-react-native (keeping gift icon for rewards/stash)
    3. `squad` — title "Your Squad", icon `Users` from lucide-react-native

    Each tab uses `tabBarIcon` callback for icons with active/inactive coloring.

    **Step 4: Add ParkerFAB overlay to tab layout**

    In the tab layout, render `<ParkerFAB />` as a sibling to the tab navigator.
    Wrap the layout in a View with `flex: 1`:
    ```
    <View style={{ flex: 1 }}>
      <MaterialTopTabs ... />
      <ParkerFAB />
    </View>
    ```

    ParkerFAB is absolutely positioned so it overlays the tab content in bottom-right corner.

    **Step 5: Remove old tab screens**

    Delete `app/(tabs)/explore.tsx` (replaced by squad.tsx)
    Delete `app/(tabs)/rewards.tsx` (replaced by stash.tsx)
    Delete `app/(tabs)/profile.tsx` (moved to modals)

    **IMPORTANT:** Do NOT modify `app/(tabs)/index.tsx` (Home screen) in this task. It will be updated in Plans 02-02 and 02-03.
  </action>
  <verify>
    `npx tsc --noEmit` passes with zero errors.
    `ls app/(tabs)/` shows only: _layout.tsx, index.tsx, stash.tsx, squad.tsx (no explore.tsx, rewards.tsx, profile.tsx)
    `ls app/(modals)/profile.tsx` exists.
    `grep -r "ParkerFAB" app/(tabs)/_layout.tsx` confirms FAB is rendered in tab layout.
  </verify>
  <done>
    Tab layout restructured: 3 tabs (Home, Your Stash, Your Squad) with Material Top Tabs at bottom, swipe enabled, horizontal slide animations. Parker FAB overlays all tabs. Profile moved to modal route. Old explore.tsx, rewards.tsx, and profile.tsx tab files removed.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero TypeScript errors
2. Tab layout file uses Material Top Tabs with `tabBarPosition="bottom"` and `swipeEnabled={true}`
3. Three tab screens exist: index.tsx, stash.tsx, squad.tsx
4. ParkerFAB component exists and is rendered in tab layout
5. Profile screen exists at app/(modals)/profile.tsx
6. Old tab files (explore.tsx, rewards.tsx, profile.tsx) are removed from app/(tabs)/
7. `app/_layout.tsx` has (modals) Stack.Screen for modal presentation
</verification>

<success_criteria>
- Bottom tab bar shows exactly 3 tabs: Home, Your Stash, Your Squad
- Tab swiping works with horizontal slide animation
- Parker FAB (PawPrint icon) renders in bottom-right corner with spring animation
- Parker FAB navigates to /chat on tap
- Profile is accessible as a modal route at /(modals)/profile
- TypeScript compilation passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/02-navigation-layout/02-01-SUMMARY.md`
</output>
