---
phase: 04-your-stash-your-squad
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - components/squad/SegmentedControl.tsx
  - components/squad/LeaderboardRow.tsx
  - components/squad/LeaderboardWidget.tsx
  - app/(tabs)/squad.tsx
  - components/stash/CLAUDE.md
  - components/squad/CLAUDE.md
autonomous: true

must_haves:
  truths:
    - "Your Squad screen shows 'Your Squad' title and 'Everything's better together.' subtitle"
    - "Leaderboard widget shows Friends/Global pill toggle that switches displayed data"
    - "Ranked rows display avatar, name, total time (hours + minutes), and current streak badge"
    - "Current user row is visually highlighted with brand accent background at ~10% opacity"
    - "Top 10 entries shown by default with 'Show More' button to expand"
    - "Add Friend button in header shows Coming Soon toast (already exists)"
  artifacts:
    - path: "components/squad/SegmentedControl.tsx"
      provides: "Reusable pill-style Friends/Global toggle"
      exports: ["SegmentedControl"]
    - path: "components/squad/LeaderboardRow.tsx"
      provides: "Single leaderboard entry row with avatar, name, time, streak"
      exports: ["LeaderboardRow"]
    - path: "components/squad/LeaderboardWidget.tsx"
      provides: "Full leaderboard with toggle, rows, and Show More"
      exports: ["LeaderboardWidget"]
    - path: "app/(tabs)/squad.tsx"
      provides: "Complete Your Squad screen with leaderboard widget"
    - path: "components/stash/CLAUDE.md"
      provides: "Documentation for stash components"
    - path: "components/squad/CLAUDE.md"
      provides: "Documentation for squad components"
  key_links:
    - from: "app/(tabs)/squad.tsx"
      to: "components/squad/LeaderboardWidget.tsx"
      via: "import and render in ScrollView"
      pattern: "import.*LeaderboardWidget"
    - from: "components/squad/LeaderboardWidget.tsx"
      to: "@/lib/mock"
      via: "import MOCK_LEADERBOARD_FRIENDS and MOCK_LEADERBOARD_GLOBAL"
      pattern: "MOCK_LEADERBOARD_(FRIENDS|GLOBAL)"
    - from: "components/squad/LeaderboardWidget.tsx"
      to: "components/squad/SegmentedControl.tsx"
      via: "render toggle for Friends/Global switching"
      pattern: "import.*SegmentedControl"
    - from: "components/squad/LeaderboardWidget.tsx"
      to: "components/squad/LeaderboardRow.tsx"
      via: "render rows for each leaderboard entry"
      pattern: "import.*LeaderboardRow"
---

<objective>
Build the Your Squad screen with full leaderboard widget, segmented control toggle, and ranked entries.

Purpose: Delivers the community leaderboard experience -- users can toggle between Friends and Global rankings, see detailed entries with avatar/name/time/streak, and expand beyond top 10. This is the dedicated leaderboard destination from Home's "View All".
Output: Three squad components (SegmentedControl, LeaderboardRow, LeaderboardWidget) and fully assembled squad.tsx screen replacing placeholder, plus CLAUDE.md docs for both stash and squad component directories.
</objective>

<execution_context>
@/Users/turbolaunch/.claude/get-shit-done/workflows/execute-plan.md
@/Users/turbolaunch/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-your-stash-your-squad/04-CONTEXT.md
@.planning/phases/04-your-stash-your-squad/04-RESEARCH.md

@lib/mock/types.ts
@lib/mock/data.ts
@app/(tabs)/squad.tsx
@components/home/LeaderboardPreview.tsx
@contexts/theme-context.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SegmentedControl, LeaderboardRow, and LeaderboardWidget components</name>
  <files>
    components/squad/SegmentedControl.tsx
    components/squad/LeaderboardRow.tsx
    components/squad/LeaderboardWidget.tsx
  </files>
  <action>
Create `components/squad/` directory with three components:

**SegmentedControl.tsx** - Reusable pill-style toggle:
- Generic props: `options: { key: string; label: string }[]`, `activeKey: string`, `onChange: (key: string) => void`
- Layout: Row of Pressable pills inside a rounded container with `colors.backgroundSecondary` background
- Active pill: `colors.accent` background with white text
- Inactive pill: transparent background with `colors.textSecondary` text
- Larger/more prominent than Home preview version: paddingVertical 10, paddingHorizontal 28, fontSize 15, fontWeight "600"
- Outer container: borderRadius 16, padding 4, gap 4, alignSelf "center"
- Use `useTheme()` for colors

**LeaderboardRow.tsx** - Single leaderboard entry:
- Props: `entry: MockLeaderboardEntry`, `isHighlighted: boolean`
- Layout (horizontal row):
  1. Rank number (width 28, fontSize 17, fontWeight "700", color textSecondary)
  2. Avatar using HeroUI Avatar (size "sm") with Image + Fallback (initials pattern from LeaderboardPreview: split name, take first chars, uppercase, slice to 2). Avatar requires `alt={entry.displayName}` prop.
  3. Display name (flex 1, fontSize 15, fontWeight "500", color textPrimary)
  4. Time display: Format as hours + minutes -- `Math.floor(entry.totalTime / 60)h ${entry.totalTime % 60}m` (more detail than Home preview which shows hours only). FontWeight "600", color textSecondary, fontSize 14.
- If `isHighlighted` (current user): row background is `${colors.accent}18` (~10% opacity), border-radius 12
- Row padding: 12px vertical, 12px horizontal. Gap 12 between elements.
- Use `useTheme()` for colors

**LeaderboardWidget.tsx** - Full leaderboard with toggle and Show More:
- No props -- self-contained component (imports mock data directly)
- State: `activeTab: 'friends' | 'global'` (default 'friends'), `showAll: boolean` (default false)
- Data selection: `activeTab === 'friends' ? MOCK_LEADERBOARD_FRIENDS : MOCK_LEADERBOARD_GLOBAL`
- Display logic: If `showAll`, show all entries. Otherwise show first 10 (top 10). Note: Friends has 5 entries, Global has 10, so "Show More" only meaningful for Global or if more data added later.
- Reset `showAll` to false when `activeTab` changes (switching tabs resets expansion)
- Layout (top to bottom):
  1. SegmentedControl with options `[{ key: 'friends', label: 'Friends' }, { key: 'global', label: 'Global' }]`
  2. List of LeaderboardRow components mapped from visible entries. Pass `isHighlighted={entry.isCurrentUser}`.
  3. "Show More" button (only if entries are truncated): Centered text link in `colors.accent`, fontSize 15, fontWeight "600", with ChevronDown icon (lucide-react-native) to the right. On tap: toggle `showAll`. Text changes to "Show Less" with ChevronUp when expanded.
- Gap: 4px between rows, 16px after segmented control, 8px before Show More
  </action>
  <verify>
Run `bunx tsc --noEmit` -- zero type errors. All three files exist with proper typed exports.
  </verify>
  <done>
SegmentedControl renders pill toggle for any set of options. LeaderboardRow renders a single entry with avatar, name, time (hours+minutes), and highlight state. LeaderboardWidget composes both with Friends/Global toggle, top 10 limit, and Show More expansion.
  </done>
</task>

<task type="auto">
  <name>Task 2: Assemble Your Squad screen and create component documentation</name>
  <files>
    app/(tabs)/squad.tsx
    components/stash/CLAUDE.md
    components/squad/CLAUDE.md
  </files>
  <action>
**Rewrite `app/(tabs)/squad.tsx`** replacing placeholder content with full leaderboard screen:

- Keep existing pattern: TopBar, SafeAreaInsets, pull-to-refresh with affirmation cycling, Add Friend button with Coming Soon toast
- Layout within ScrollView (top to bottom):
  1. TopBar (existing)
  2. Header row (existing): "Your Squad" title (text-3xl font-bold) + "Add Friend" button on the right
  3. Subtitle (existing): "Everything's better together." (text-base, secondary color)
  4. LeaderboardWidget: Import and render with mt-4 spacing below subtitle
  5. Bottom padding (paddingBottom: 100, already exists)
- Import LeaderboardWidget from `@/components/squad/LeaderboardWidget`

**Create `components/stash/CLAUDE.md`** documenting stash components:
- Document RewardCard (props, variants, press animation), RewardCarousel (FlatList pattern, page dots, snap behavior), RewardsGrid (numColumns pattern, scrollEnabled=false), RewardToaster (BottomSheetModal pattern, ref-based present/dismiss, placeholder types)
- Include import paths, key patterns (nested scroll handling, item width calculation), and mock data sources
- Follow the style of `components/home/CLAUDE.md`

**Create `components/squad/CLAUDE.md`** documenting squad components:
- Document SegmentedControl (generic reusable toggle, props), LeaderboardRow (entry display, highlight pattern, avatar with alt prop), LeaderboardWidget (self-contained, toggle + Show More, data switching)
- Include import paths, theme integration, mock data sources
- Note that SegmentedControl is generic and can be reused elsewhere (not leaderboard-specific)
- Follow the style of `components/home/CLAUDE.md`
  </action>
  <verify>
Run `bunx tsc --noEmit` -- zero type errors. Run `bunx expo start` and navigate to Your Squad tab -- should show header with "Your Squad" title and "Add Friend", subtitle "Everything's better together.", Friends/Global toggle, and ranked leaderboard entries. Friends tab shows 5 entries. Global tab shows 10 entries. Current user row (Sarah Johnson) highlighted. Verify CLAUDE.md files exist at `components/stash/CLAUDE.md` and `components/squad/CLAUDE.md`.
  </verify>
  <done>
Your Squad screen shows full leaderboard with Friends/Global toggle, ranked rows with avatar/name/time, current user highlighted, and Show More expansion. Add Friend shows Coming Soon toast. Both stash and squad component directories have CLAUDE.md documentation.
  </done>
</task>

</tasks>

<verification>
1. `bunx tsc --noEmit` passes with zero errors
2. Your Squad tab shows "Your Squad" title and "Everything's better together." subtitle
3. Friends/Global segmented control toggles leaderboard data
4. Friends tab: 5 entries with Sarah Johnson highlighted at rank 2
5. Global tab: 10 entries with Sarah Johnson highlighted at rank 4
6. Each row shows rank, avatar, name, and time formatted as "Xh Ym"
7. Show More button appears when entries are truncated (visible on Global if more entries exist)
8. Add Friend button shows Coming Soon toast (preserved from Phase 2)
9. Pull-to-refresh works on the screen
10. `components/stash/CLAUDE.md` and `components/squad/CLAUDE.md` exist with accurate documentation
</verification>

<success_criteria>
- Your Squad screen shows complete leaderboard with Friends/Global toggle
- Ranked rows display avatar, name, total time (hours+minutes), current user highlighted
- SegmentedControl switches between Friends and Global datasets
- Show More expands to show all entries
- Component documentation created for both stash and squad directories
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-your-stash-your-squad/04-03-SUMMARY.md`
</output>
