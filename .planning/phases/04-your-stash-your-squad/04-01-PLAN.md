---
phase: 04-your-stash-your-squad
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/stash/RewardCard.tsx
  - components/stash/RewardCarousel.tsx
  - components/stash/RewardsGrid.tsx
  - app/(tabs)/stash.tsx
autonomous: true

must_haves:
  truths:
    - "Your Stash shows a featured rewards horizontal carousel with page indicator dots"
    - "Carousel contains up to 6 featured reward cards with App Store card style (image-dominant with text overlay)"
    - "2-column rewards grid appears below carousel as one continuous scroll"
    - "Grid tiles show image thumbnail, vendor name, and reward title"
    - "Pull-to-refresh works on entire screen with mock 800ms delay"
    - "Reward cards respond to press with subtle scale feedback"
  artifacts:
    - path: "components/stash/RewardCard.tsx"
      provides: "Single reward card component reused in carousel and grid"
      exports: ["RewardCard"]
    - path: "components/stash/RewardCarousel.tsx"
      provides: "Horizontal FlatList carousel with page dots"
      exports: ["RewardCarousel"]
    - path: "components/stash/RewardsGrid.tsx"
      provides: "2-column FlatList grid with numColumns={2}"
      exports: ["RewardsGrid"]
    - path: "app/(tabs)/stash.tsx"
      provides: "Complete Your Stash screen assembling all stash components"
  key_links:
    - from: "app/(tabs)/stash.tsx"
      to: "components/stash/RewardCarousel.tsx"
      via: "import and render in ScrollView"
      pattern: "import.*RewardCarousel"
    - from: "app/(tabs)/stash.tsx"
      to: "components/stash/RewardsGrid.tsx"
      via: "import and render below carousel"
      pattern: "import.*RewardsGrid"
    - from: "components/stash/RewardCarousel.tsx"
      to: "@/lib/mock"
      via: "import MOCK_REWARDS filtered by featured=true"
      pattern: "MOCK_REWARDS\\.filter"
    - from: "components/stash/RewardsGrid.tsx"
      to: "@/lib/mock"
      via: "import MOCK_REWARDS filtered by featured=false"
      pattern: "MOCK_REWARDS\\.filter"
---

<objective>
Build the Your Stash screen with featured rewards carousel and 2-column rewards grid.

Purpose: Delivers the rewards browsing experience -- users see featured rewards in a swipeable carousel above a browsable grid of all other rewards, creating a content-rich tab screen.
Output: Three stash components (RewardCard, RewardCarousel, RewardsGrid) and fully assembled stash.tsx screen replacing the current placeholder.
</objective>

<execution_context>
@/Users/turbolaunch/.claude/get-shit-done/workflows/execute-plan.md
@/Users/turbolaunch/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-your-stash-your-squad/04-CONTEXT.md
@.planning/phases/04-your-stash-your-squad/04-RESEARCH.md

@lib/mock/types.ts
@lib/mock/data.ts
@app/(tabs)/stash.tsx
@components/home/HeroSwiper.tsx
@contexts/theme-context.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RewardCard, RewardCarousel, and RewardsGrid components</name>
  <files>
    components/stash/RewardCard.tsx
    components/stash/RewardCarousel.tsx
    components/stash/RewardsGrid.tsx
  </files>
  <action>
Create `components/stash/` directory with three components:

**RewardCard.tsx** - Single reward card used in both carousel and grid:
- Props: `reward: MockReward`, `onPress: (reward: MockReward) => void`, `variant: 'carousel' | 'grid'`
- Carousel variant: Large image (expo-image Image component) with vendor name + reward title overlaid at bottom using a dark gradient overlay (App Store card style). Aspect ratio ~16:10 for carousel cards. Use `expo-image` Image for optimized loading.
- Grid variant: Smaller image thumbnail at top, vendor name below in secondary text, reward title in primary text. Fixed height for consistent grid rows.
- Both variants: Rounded corners (borderRadius 16), subtle scale-down press feedback using Reanimated `useAnimatedStyle` + `withTiming` (scale to 0.97 on pressIn, 1.0 on pressOut, 100ms duration). Wrap in Animated Pressable.
- Use `useTheme()` for colors. Import MockReward from `@/lib/mock`.

**RewardCarousel.tsx** - Featured rewards horizontal carousel:
- Props: `rewards: MockReward[]`, `onRewardPress: (reward: MockReward) => void`
- Horizontal FlatList following HeroSwiper pattern: `snapToInterval={CARD_WIDTH}`, `decelerationRate="fast"`, `showsHorizontalScrollIndicator={false}`
- CARD_WIDTH = screen width - 32 (16px padding each side)
- Page indicator dots below carousel synced via `onViewableItemsChanged` (use `useRef` for viewability config, `useCallback` for handler -- same pattern as HeroSwiper)
- Each item renders `<RewardCard variant="carousel" />` wrapped in a View with `width: CARD_WIDTH`
- `contentContainerStyle={{ paddingHorizontal: 16 }}`, gap between cards via `ItemSeparatorComponent` or item margin

**RewardsGrid.tsx** - 2-column rewards grid:
- Props: `rewards: MockReward[]`, `onRewardPress: (reward: MockReward) => void`
- FlatList with `numColumns={2}`, `scrollEnabled={false}` (critical: parent ScrollView handles scroll)
- Calculate ITEM_WIDTH: `(SCREEN_WIDTH - PADDING * 2 - GAP) / 2` where PADDING=16, GAP=12
- `columnWrapperStyle={{ gap: GAP, paddingHorizontal: PADDING, marginBottom: 12 }}`
- Each item renders `<RewardCard variant="grid" />` wrapped in a View with `width: ITEM_WIDTH`
- `keyExtractor` using reward.id
  </action>
  <verify>
Run `bunx tsc --noEmit` -- zero type errors. All three files exist with proper exports and typed props.
  </verify>
  <done>
RewardCard renders both carousel and grid variants with press animation. RewardCarousel shows horizontal swiper with page dots. RewardsGrid shows 2-column layout with disabled scroll.
  </done>
</task>

<task type="auto">
  <name>Task 2: Assemble Your Stash screen with carousel + grid</name>
  <files>
    app/(tabs)/stash.tsx
  </files>
  <action>
Rewrite `app/(tabs)/stash.tsx` replacing placeholder content with full rewards browsing screen:

- Keep existing pattern: TopBar, SafeAreaInsets, pull-to-refresh with affirmation cycling
- Increase refresh timeout from 500ms to 800ms (per CONTEXT.md mock delay pattern)
- Layout within ScrollView (top to bottom, one continuous scroll):
  1. TopBar (existing)
  2. Screen header: "Your Stash" title (text-3xl font-bold) + "Rewards and offers from our partners" subtitle -- keep existing header
  3. RewardCarousel: Pass `MOCK_REWARDS.filter(r => r.featured)` as rewards prop
  4. RewardsGrid: Pass `MOCK_REWARDS.filter(r => !r.featured)` as rewards prop, rendered below carousel with mt-4 spacing
  5. Bottom padding (paddingBottom: 100 for tab bar clearance, already exists)
- Carousel flows directly into grid -- no section headers or visual dividers between them (per CONTEXT.md: "one continuous scroll")
- Wire `onRewardPress` callbacks on both carousel and grid -- for now, just log or no-op (Plan 02 adds the bottom sheet)
- Use `useCallback` for the reward press handler to avoid re-renders

Import mock data: `MOCK_REWARDS` from `@/lib/mock`
Import components: `RewardCarousel` from `@/components/stash/RewardCarousel`, `RewardsGrid` from `@/components/stash/RewardsGrid`
  </action>
  <verify>
Run `bunx tsc --noEmit` -- zero type errors. Run `bunx expo start` and navigate to Your Stash tab -- should show carousel with 3 featured cards (swipeable with dots) above a 2-column grid of 5 non-featured rewards. Pull-to-refresh spins for 800ms. Cards have press scale animation.
  </verify>
  <done>
Your Stash screen shows featured carousel with page dots flowing into 2-column grid as one continuous scrollable view. Pull-to-refresh works. Card press animations respond to touch. Carousel snaps between cards.
  </done>
</task>

</tasks>

<verification>
1. `bunx tsc --noEmit` passes with zero errors
2. Your Stash tab shows horizontal carousel with 3 featured reward cards
3. Page dots track current carousel position on swipe
4. Below carousel: 5 rewards in 2-column grid with consistent spacing
5. Carousel and grid form one continuous scroll (no section breaks)
6. Pull-to-refresh activates with 800ms mock delay
7. Reward cards show subtle scale animation on press
8. No VirtualizedList nesting warnings in console (grid scrollEnabled={false})
</verification>

<success_criteria>
- Featured carousel with page dots is swipeable and snaps between cards
- 2-column grid below carousel renders all non-featured rewards
- One continuous scroll from carousel through grid
- Pull-to-refresh works with 800ms delay
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-your-stash-your-squad/04-01-SUMMARY.md`
</output>
