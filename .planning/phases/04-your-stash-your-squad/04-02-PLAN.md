---
phase: 04-your-stash-your-squad
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - components/stash/RewardToaster.tsx
  - app/(tabs)/stash.tsx
autonomous: true

must_haves:
  truths:
    - "Tapping any reward card (carousel or grid) opens a bottom sheet covering ~50% of screen height"
    - "Bottom sheet shows reward title, vendor name, description, and a QR/barcode/code placeholder"
    - "Reward Toaster has a Redeem button that shows Coming Soon toast on tap"
    - "Bottom sheet dismisses via swipe down or backdrop tap"
    - "Dismissing returns to Your Stash with no navigation side effects"
  artifacts:
    - path: "components/stash/RewardToaster.tsx"
      provides: "BottomSheetModal wrapper for reward detail display"
      exports: ["RewardToaster"]
    - path: "app/(tabs)/stash.tsx"
      provides: "Your Stash screen with RewardToaster wired to card presses"
  key_links:
    - from: "app/(tabs)/stash.tsx"
      to: "components/stash/RewardToaster.tsx"
      via: "ref-based present() on reward card press"
      pattern: "bottomSheetRef\\.current\\??\\.present"
    - from: "components/stash/RewardToaster.tsx"
      to: "@gorhom/bottom-sheet"
      via: "BottomSheetModal with 50% snapPoint"
      pattern: "BottomSheetModal"
    - from: "components/stash/RewardToaster.tsx"
      to: "heroui-native"
      via: "useToast for Coming Soon on Redeem tap"
      pattern: "useToast|toast\\.show"
---

<objective>
Add the Reward Toaster bottom sheet to Your Stash screen so tapping any reward card opens a detail overlay.

Purpose: Completes the reward browsing flow -- users tap to see details and a redemption placeholder, then dismiss to continue browsing. Validates the BottomSheetModal integration pattern for the app.
Output: RewardToaster component and updated stash.tsx with bottom sheet wired to all reward card presses.
</objective>

<execution_context>
@/Users/turbolaunch/.claude/get-shit-done/workflows/execute-plan.md
@/Users/turbolaunch/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-your-stash-your-squad/04-CONTEXT.md
@.planning/phases/04-your-stash-your-squad/04-RESEARCH.md
@.planning/phases/04-your-stash-your-squad/04-01-SUMMARY.md

@lib/mock/types.ts
@app/(tabs)/stash.tsx
@components/stash/RewardCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create RewardToaster bottom sheet component</name>
  <files>
    components/stash/RewardToaster.tsx
  </files>
  <action>
Create `components/stash/RewardToaster.tsx` using `@gorhom/bottom-sheet`:

**Component interface:**
- Uses `forwardRef` pattern to expose `BottomSheetModal` ref to parent
- Props: `reward: MockReward | null`, `onDismiss: () => void`

**BottomSheetModal setup:**
- `snapPoints={['50%']}` -- half screen height per CONTEXT.md
- `enablePanDownToClose={true}` -- swipe down to dismiss
- `backdropComponent` -- render `BottomSheetBackdrop` with `appearsOnIndex={0}`, `disappearsOnIndex={-1}` for backdrop tap dismissal
- `onDismiss` prop wired to parent callback (clears selected reward state)

**Content layout (inside BottomSheetModal):**
- Conditional render: only show content when `reward` is not null
- Top section: Vendor name (secondary text, uppercase, small), Reward title (text-xl font-bold), Description (text-base, secondary color), separated by spacing
- Middle section: QR/barcode/code placeholder based on `reward.rewardType`:
  - `"qr"`: Gray rounded rectangle (160x160) centered with "QR Code" text inside and reward.rewardValue below in small monospace text
  - `"barcode"`: Gray rounded rectangle (200x80) centered with "||||||||||||" barcode placeholder text and reward.rewardValue below
  - `"code"`: Accent-bordered rounded rectangle containing reward.rewardValue in large monospace font, centered
- Bottom section: Full-width "Redeem" button. Use HeroUI `Button` component if available, otherwise a styled Pressable with accent background, white text, rounded corners. On press: show HeroUI toast via `useToast()` with label "Coming Soon", description "Redemption will be available soon!", variant "default", placement "top".

**Styling:**
- Use `useTheme()` for all colors
- Padding: 20px horizontal, 16px vertical inside the sheet
- Import `BottomSheetBackdrop` type for backdrop props: `import type { BottomSheetDefaultBackdropProps } from '@gorhom/bottom-sheet/lib/typescript/components/bottomSheetBackdrop/types'`
- Memoize renderBackdrop with `useCallback`
  </action>
  <verify>
Run `bunx tsc --noEmit` -- zero type errors. RewardToaster.tsx exports properly with correct BottomSheetModal ref forwarding.
  </verify>
  <done>
RewardToaster renders as a half-screen bottom sheet with reward details, type-appropriate placeholder (QR/barcode/code), Redeem button with Coming Soon toast, and proper dismiss behavior (swipe down + backdrop tap).
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire RewardToaster into Your Stash screen</name>
  <files>
    app/(tabs)/stash.tsx
  </files>
  <action>
Update `app/(tabs)/stash.tsx` to integrate the RewardToaster:

**State management:**
- Add `selectedReward` state: `useState<MockReward | null>(null)`
- Create `bottomSheetRef` using `useRef<BottomSheetModal>(null)`

**Wire card presses:**
- Update the `onRewardPress` handler (currently no-op from Plan 01) to:
  1. Set `selectedReward` to the pressed reward
  2. Call `bottomSheetRef.current?.present()` to open the toaster

**Dismiss handling:**
- Create `handleDismiss` callback that sets `selectedReward` to null
- Pass as `onDismiss` prop to RewardToaster

**Render RewardToaster:**
- Add `<RewardToaster ref={bottomSheetRef} reward={selectedReward} onDismiss={handleDismiss} />` OUTSIDE the ScrollView but inside the root View (sibling to ScrollView, not nested within it)
- This ensures the bottom sheet overlays properly without scroll interference

**Imports:**
- Add: `BottomSheetModal` from `@gorhom/bottom-sheet` (for ref type), `RewardToaster` from `@/components/stash/RewardToaster`, `MockReward` from `@/lib/mock`
  </action>
  <verify>
Run `bunx tsc --noEmit` -- zero type errors. Run `bunx expo start` and navigate to Your Stash: tap any carousel card or grid card -- bottom sheet slides up showing reward details with appropriate placeholder. Tap Redeem -- Coming Soon toast appears. Swipe down or tap backdrop -- sheet dismisses. Tap another card -- new reward details appear. Screen returns to normal browsing after dismiss with no navigation changes.
  </verify>
  <done>
Tapping any reward card opens the Reward Toaster bottom sheet at 50% height showing reward details and type-appropriate placeholder. Redeem button shows Coming Soon toast. Sheet dismisses via swipe down or backdrop tap. No navigation side effects on dismiss.
  </done>
</task>

</tasks>

<verification>
1. `bunx tsc --noEmit` passes with zero errors
2. Tap carousel card -- bottom sheet slides up at ~50% screen height
3. Tap grid card -- same bottom sheet opens with different reward details
4. Bottom sheet shows vendor, title, description, and type-appropriate placeholder
5. "Redeem" button shows Coming Soon toast
6. Swipe down dismisses the sheet
7. Tap backdrop dismisses the sheet
8. After dismiss, Your Stash screen is unaffected (no navigation occurred)
9. Can open another reward immediately after dismissing
</verification>

<success_criteria>
- Any reward card tap opens bottom sheet toaster
- Toaster shows reward detail with QR/barcode/code placeholder
- Redeem button shows Coming Soon toast
- Sheet dismisses via swipe down and backdrop tap
- No navigation side effects on open or dismiss
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-your-stash-your-squad/04-02-SUMMARY.md`
</output>
